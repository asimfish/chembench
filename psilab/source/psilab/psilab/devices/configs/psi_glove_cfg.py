# Copyright (c) 2022-2024, The PsiRobot Project Developers
# Author: Feng Yunduo
# Date: 2025-10-30
# Vesion: 1.0

""" Common Modules  """ 
import numpy
import torch


""" PsiLab Modules  """ 
from psilab.devices.psi_glove.psi_tp_cfg import PsiTpCfg


PSIGLOVE_PSI_DC_02_CFG = PsiTpCfg(
    # 数据设备类型，用于tensor
    device  = "cuda:0",
    # 根据tracker serial区分左右手
    tracker_serial_left  = "LHR-80728EA0",
    tracker_serial_right = "LHR-B72584D2",
    delta_pos_scale = [2.0,2.0,2.0],
    
    # 手套参数
    glove_port_left = "/dev/ttyACM0",
    glove_port_right = "/dev/ttyACM1",
    glove_baudrate = 500000,
    # 从手套中提取的关节信息索引（展平数据）
    glove_index =[4,7,11,15,19,2],
    # 手套返回的ADC值范围，用来归一化
    # glove_left_adc_min =[1156, 2537, 2628, 2125, 3549, 1109, 2650, 2170, 1677, 775, 2508, 2126, 1833, 851, 2634, 2308, 1924, 1323, 2739, 2275, 2042],
    # glove_left_adc_max =[2014, 2995, 3161, 2501, 3688, 1656, 3055, 3217, 1791, 1560, 2931, 3286, 1960, 1537, 2939, 3241, 2072, 1559, 3086, 3279, 2385],
    # glove_right_adc_min = [1071, 2541, 2621, 2499, 583, 1103, 2630, 2210, 2254, 824, 2624, 2405, 2104, 784, 2609, 2393, 2073, 1074, 2843, 2494, 1891],
    # glove_right_adc_max =[1897, 2956, 3049, 2792, 796, 1603, 3014, 3176, 2360, 1364, 2871, 3260, 2191, 1435, 2885, 3090, 2132, 1399, 3106, 3283, 2179],
    
    ##liyufeng 
    # glove_left_adc_min = [1934, 1557, 3449, 1904, 3015, 382, 2573, 1259, 2242, 1564, 2256, 1082, 2057, 7, 2600, 1395, 1964, 485, 2427, 1420, 1816],
    # glove_left_adc_max = [1936, 1560, 3451, 1905, 3017, 384, 2576, 1261, 2244, 1566, 2259, 1084, 2060, 9, 2602, 1398, 1967, 488, 2429, 1422, 1818],
    # glove_right_adc_min = [1366, 2577, 2718, 2822, 722, 1277, 2628, 2232, 2280, 1131, 2642, 2333, 2027, 908, 2615, 2258, 1946, 951, 2785, 2298, 1761],
    # glove_right_adc_max = [1659, 2797, 2997, 2897, 773, 1583, 2819, 2663, 2438, 1430, 2803, 2942, 2143, 1421, 2849, 2924, 2030, 1273, 2937, 2940, 1984],
    
    # glove_left_adc_min = [1529, 3069, 3318, 1986, 2820, 85, 2084, 1959, 2441, 6, 2773, 1712, 2353, 350, 2879, 2359, 2265, 563, 2215, 2849, 2069],
    # glove_left_adc_max  = [1531, 3071, 3320, 1987, 2822, 88, 2086, 1961, 2443, 9, 2775, 1714, 2355, 353, 2881, 2363, 2268, 565, 2216, 2852, 2071],
    # glove_right_adc_min = [1067, 2468, 2640, 2820, 809, 1175, 2576, 2199, 2200, 888, 2524, 2183, 2014, 718, 2591, 2213, 2019, 837, 2837, 2490, 1931],
    # glove_right_adc_max = [1454, 2667, 2862, 2847, 812, 1466, 2731, 2533, 2318, 1239, 2668, 2673, 2078, 1350, 2778, 2797, 2093, 1158, 2927, 3146, 2087],

    glove_left_adc_min =[1010, 2637, 2986, 1923, 2860, 85, 1892, 2002, 2383, 6, 2660, 1646, 2229, 350, 2852, 2162, 2138, 562, 2487, 2647, 2149],
    glove_left_adc_max = [1012, 2640, 2988, 1925, 2862, 88, 1893, 2004, 2386, 9, 2662, 1648, 2230, 352, 2854, 2164, 2141, 564, 2489, 2650, 2151],
    glove_right_adc_min = [1211, 2579, 2775, 2789, 780, 1120, 2574, 2221, 2288, 898, 2525, 2285, 2089, 823, 2567, 2321, 2088, 847, 2792, 2563, 1913],
    glove_right_adc_max = [1550, 2771, 2980, 2812, 830, 1471, 2689, 2444, 2328, 1172, 2583, 2458, 2124, 1227, 2681, 2623, 2137, 1177, 2900, 2953, 2008],
    
    # traker实际位置比手掌要高0.11米
    # tracker2wrist_mat = numpy.array([[1, 0, 0, 0],
    #                                 [0, 1, 0, -0.11],
    #                                 [0, 0, 1, 0.],
    #                                 [0, 0, 0, 1]]),
    
    # Tracker世界坐标系到仿真世界坐标系的四元数,grd_yup2grd_zup的四元数形式
    # tracker2world_quat = numpy.array([0.6532815,0.6532815, 0.2705981, 0.2705981]),
    # tracker2world_quat = numpy.array([0.6532815,0.6532815, -0.2705981, -0.2705981]),
    tracker2world_quat = numpy.array([0.0,0.0,0.707,0.707]),

    # 双臂末端初始位姿,应为手面平行于世界坐标系XY平面,手掌朝向世界坐标系Z轴负方向
    eef_left_quat_init = numpy.array([0,-0.7071068, 0, -0.7071068]),
    eef_right_quat_init = numpy.array([0,-0.7071068, 0, -0.7071068])
)
